# Chatterbox TTS - Standalone Stack
# Uses upstream Chatterbox-TTS-Server via git submodule
# https://github.com/devnen/Chatterbox-TTS-Server

services:
  chatterbox:
    build:
      context: ./Chatterbox-TTS-Server
      dockerfile: Dockerfile.rocm
    container_name: chatterbox-tts
    restart: unless-stopped
    ports:
      - "${TTS_PORT:-8880}:8004"
    environment:
      - HSA_OVERRIDE_GFX_VERSION=${HSA_OVERRIDE_GFX_VERSION:-11.0.1}
      - HF_HUB_ENABLE_HF_TRANSFER=1
    volumes:
      # Persistent data directories
      - ${TTS_VOICES:-./data/voices}:/app/voices
      - ${TTS_REFERENCE_AUDIO:-./data/reference_audio}:/app/reference_audio
      - ${TTS_OUTPUTS:-./data/outputs}:/app/outputs
      - ./data/logs:/app/logs
      - chatterbox_hf_cache:/app/hf_cache
      # Config file (will be created on first run if not exists)
      - ./config.yaml:/app/config.yaml
    devices:
      - /dev/kfd
      - /dev/dri
    group_add:
      - "44"   # video
      - "992"  # render
    security_opt:
      - seccomp:unconfined
    ipc: host
    shm_size: 8g
    networks:
      - ai-stack

volumes:
  chatterbox_hf_cache:

networks:
  ai-stack:
    name: ${DOCKER_NETWORK:-ai-stack}
    external: true
